{% load staticfiles %}
{% if formats %}
	<div class="formatwrapper">
		{% for format in formats %}
			<label class="format">
				<input type="radio" name="{{ name }}_format" value="{{ format.format }}"{% if format.checked %} checked="checked"{% endif %} />
				{{ format.label }}
			</label>
		{% endfor %}
	</div>
{% endif %}
<div id="id_textareawrapper_{{ name }}" class="textareawrapper">
	{{ widget|safe }}
</div>
<script type="text/javascript" charset="utf-8">
//<![CDATA[
	initialize_rich_editor(
		'{{ name }}',
		{
			lang: '{{ lang }}',
			tags: {{ tags|safe }},
			iframe_preview: '{% static 'js/wymeditor/iframe/default/wymiframe.html' %}',
			script_wymeditor: '{% static 'js/wymeditor/jquery.wymeditor.min.js' %}',
			static_base: '{%static '' %}'
		}
	);

{% if formats %}
var switchFormat = function() {
	if ($("input[name='{{ name }}_format'][value='raw']").is(":checked")) {
		window.rich_editors['{{ name }}'].loadFunctions['raw']();
		$("#id_textareawrapper_{{ name }} .settings").hide();
	}
	else {
		var default_editor = 'wymeditor';
		var editor = cookiemanager.getCookie('last_editor');
		var loadFunctions = window.rich_editors['{{ name }}'].loadFunctions;
		if (loadFunctions[editor] != undefined) {
			loadFunctions[editor]();
		}
		else {
			loadFunctions[default_editor]();
		}
		$("#id_textareawrapper_{{ name }} .settings").show();
	}
}
$("input[name='{{ name }}_format']").on("change", switchFormat);
{% endif %}
//]]>
</script>
